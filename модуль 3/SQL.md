**SQL** (Structured Query Language) — это язык программирования, предназначенный для работы с реляционными базами данных. Он используется для создания, модификации и управления данными в этих базах. SQL позволяет выполнять различные операции:

- **Создание и изменение таблиц**: Создание новых таблиц, добавление, изменение и удаление данных.
- **Запросы**: Выборка данных из одной или нескольких таблиц по заданным условиям.
- **Управление доступом**: Установка прав доступа к данным для пользователей.

SQL широко используется в различных областях, таких как бизнес, финансы, наука, веб-разработка и анализ данных. Он является стандартным инструментом для работы с реляционными базами данных и поддерживается большинством систем управления базами данных (СУБД).

### Основные особенности SQL:

- **Декларативный язык**: SQL описывает, что нужно сделать с данными, а не как это сделать.
- **Реляционные базы данных**: Данные хранятся в виде таблиц со строками и столбцами.
- **Удобочитаемый синтаксис**: SQL-запросы часто напоминают английские предложения, что делает их относительно простыми для понимания и использования.

### Применение SQL:

- **Анализ данных**: SQL используется для извлечения и анализа данных.
- **Веб-разработка**: Для создания динамического контента и управления учетными записями пользователей.
- **Управление базами данных**: Создание, управление и оптимизация баз данных.

## Команды

Запустить стандартного пользователя для подключения к СУБД
```bash
sudo -i -u postgres 
```

Дальше нужно запустить саму программу командой psql
```bash
psql
```

Чтоб сделать выборку данных используется следующая команда
```SQL
SELECT * FROM users;
```
\* -  обозначает все поля, а если нужны конкретные поля то их нужно указать через запятую. А после слова FROM указываются таблицы.

Счетчик который автоматически считает и присваивает значения новым данным ++i
```SQL
PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY
```

### Фильтрация данных 


1. **Оператор WHERE**:
   - Используется для фильтрации данных в запросах SELECT.
   - Позволяет выбирать строки, удовлетворяющие определенному условию.
   - Пример: `SELECT * FROM users WHERE id > 60;` — выбирает пользователей с `id` больше 60.

2. **Операторы сравнения**:
   - `=` — равно
   - `!=` — не равно
   - `>` — больше
   - `<` — меньше
   - `>=` — больше или равно
   - `<=` — меньше или равно

3. **Типы данных и оформление**:
   - Числа: используются без кавычек.
   - Текст: должен быть заключен в одинарные кавычки (например, `first_name = 'Johan'`).
   - Даты: также заключаются в одинарные кавычки (например, `created_at > '2022-06-14'`).

4. **Результат запроса**:
   - Всегда возвращает таблицу, даже если найдена одна запись или ничего не найдено.

5. **Примеры запросов**:
   - Выбор пользователя с `id = 1`: `SELECT * FROM users WHERE id = 1;`
   - Выбор всех пользователей, кроме `id = 3`: `SELECT * FROM users WHERE id != 3;`
   - Выбор курсов, созданных после 14 июня 2022: `SELECT name, created_at FROM courses WHERE created_at > '2022-06-14';`

### NULL

**NULL**:
   - Специальное значение, обозначающее отсутствие данных в ячейке таблицы.
   - Используется для незаполненных полей (например, необязательные данные, такие как дата рождения).

 **Операторы для работы с NULL**:
   - Для проверки на NULL используйте `IS NULL` и `IS NOT NULL`.
   - Стандартные операторы сравнения (`=`, `!=`, `>`, `<` и т.д.) **не работают** с NULL.

### Фильтрация строк 

Используют `LIKE` потом кусок текста и знак `%` который обозначает любое количество символов. Лайк чувствителен к регистру. Если нам все ровно на регистр, то используем `ILIKE` ^^

### Регулярные выражения — Основы SQL

1. **Регулярные выражения (RegEx)**:
   - Используются для точного поиска строк по шаблону.
   - В SQL применяется оператор `SIMILAR TO` для работы с регулярными выражениями.

2. **Основные шаблоны**:
   - `[AB]%` — строки, начинающиеся с 'A' или 'B'.
   - `%[a-z]` — строки, заканчивающиеся на любую букву.
   - `%[0-9]` — строки, заканчивающиеся на цифру.
   - `%[а-я]%` — строки, содержащие русские буквы.

3. **Символы в регулярных выражениях**:
   - `%` — любое количество любых символов.
   - `[]` — перечисление допустимых символов (например, `[AB]`).
   - `-` — диапазон символов (например, `[a-z]` или `[0-9]`).
   - `_` — ровно один любой символ.

### Логические операторы
OR (ИЛИ): Возвращает True, если выполняется хотя бы одно из условий.
AND (И): Возвращает True, только если выполняются оба условия.


### Фильтрация данных по диапазону — Основы SQL

1. **Оператор `BETWEEN`**:
   - Используется для фильтрации данных по диапазону значений.
   - Удобная альтернатива комбинации операторов `>=` и `<=`.
   - Включает в диапазон крайние значения.

2. **Примеры запросов**:
   - Фильтрация по дате:  
     ```sql
     SELECT * FROM users
     WHERE birthday BETWEEN '2022-01-01' AND '2022-02-01';
     ```
     Выбирает пользователей с датой рождения от 1 января до 1 февраля 2022 года (включительно).
   
   - Эквивалентный запрос с использованием `>=` и `<=`:  
     ```sql
     SELECT * FROM users
     WHERE birthday >= '2022-01-01' AND birthday <= '2022-02-01';
     ```

3. **Исключение диапазона**:
   - Используйте `NOT BETWEEN` для исключения значений из диапазона:  
     ```sql
     SELECT * FROM users
     WHERE birthday NOT BETWEEN '2022-01-01' AND '2022-02-01';
     ```
     Выбирает пользователей с датой рождения до 1 января или после 1 февраля 2022 года.

4. **Применение к числам**:
   - `BETWEEN` можно использовать и для числовых значений:  
     ```sql
     SELECT * FROM users
     WHERE id BETWEEN 15 AND 23;
     ```
     Выбирает пользователей с `id` от 15 до 23 (включительно).

5. **Выводы**:
   - `BETWEEN` упрощает запросы, улучшает читаемость и снижает вероятность ошибок.
   - Включает крайние значения диапазона.
   - Для исключения диапазона используйте `NOT BETWEEN`.

###  Как искать поля, соответствующие значению из набора? 

Все просто используй `IN` или `NOT IN`. 
```SQL
SELECT
    id,
    first_name,
    last_name
FROM users
WHERE id IN (1, 2, 5);
```

### Сортировка данных 

Таблицы по умолчанию сортируются как им вздумается и это не всегда совпадает с нашими требованиями, чтоб отсортировать данные мы используем `ORDER BY`.

пример:
```SQL
SELECT
    id,
    username,
    created_at
FROM users ORDER BY username;
```

База данных знает как сортировать строки числа и даты. 

#### как же управлять порядком сортировки ? 

- Прямой порядок: если ничего не указано, то `ORDER BY` отсортирует все в прямом порядке, как если бы было указано `ASC`, он подставляется автоматически, если ничего не указано 
```SQL
SELECT
    id,
    username,
    created_at
FROM users ORDER BY created_at ASC;
-- То же самое, что и
SELECT
    id,
    username,
    created_at
FROM users ORDER BY created_at;
```
- Обратный порядок сортировки: что бы выполнить обратную сортировку укажем `DESC`.
- Сортировка по нескольким полям: просто перечисляем поля через запятую и для каждого поля указываем вид сортировки. (помни, что по умолчанию ставиться `ASC`)

#### что делать с Null значениями? 

СУБД сама решает куда засунуть нулл значения, но если нам нужно их нахождение конкретно, то указываем 
- `NULLS FIRST`
- `NULLS LAST`

### Ограничение выборки 

Таблички обычно большие и для того, что бы получить данные, которые реально обработать, придумали `LIMIT`. 

Пример:
```SQL
SELECT
    id,
    username,
    email
FROM users LIMIT 10;
```

Лимит всегда используется с сортировкой, ведь мы не знаем какие 10 записей нам выдаст СУБД без сортировки. Вот пример использования с сортировкой:
```SQL
SELECT
	id,
	username,
	email
FROM users ORDER BY id LIMIT 10;
```

#### Как показать все данные по выборкам ?

Для этого нам понадобится *плагинация*. Это механизм, который позволяет перемещаться по страницам.

Чтобы реализовать пагинацию, одного `LIMIT` недостаточно. Еще понадобится смещение `OFFSET`:
```SQL
SELECT
    id,
    username,
    email
FROM users ORDER BY id LIMIT 10 OFFSET 10;
```

### Уникальные строки

В языке SQL существует специальный оператор `DISTINCT`. Он удаляет повторяющиеся строки и оставляет только уникальные. Запрос с этим оператором будет выглядеть так: 
```SQL
SELECT DISTINCT course_id FROM course_memders ORDER BY course_id;
```

Таким образом, чтобы исключить повторяющиеся строки, нужно после оператора `SELECT` указать `DISTINCT` и перечислить все нужные столбцы.

Если мы добавим в наш запрос еще одно поле `user_id`, то это изменит результат запроса. В эту выборку попадут строки с уникальным сочетанием курса и слушателя.

По отдельности курсы и слушатели могут повторяться, но их сочетание будет уникальным

Так же есть оператор `DISTINCT ON` в него в скобки можно указать поле уникальность которого будет проверяться. Так же туда можно засунуть и несколько значений.

#### что такая сортировки и дискрит он

В `ORDER BY` важно первым указывать те поля, которые указаны в скобках в дисккрит он.